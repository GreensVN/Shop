<!DOCTYPE html>
<html lang="vi">
<!-- (Phần <head> và CSS giữ nguyên như phiên bản trước) -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tài khoản - Shop Grow A Garden</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAdgAAAHYBTnsmCAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAANCSURBVFiFtZc9aBRBFMd/M7ubTWI0GoM2NmIhFlYWYmVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVhYWVh">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS styles remain the same as the previous correct version */
        :root{--primary-color:#e63946;--secondary-color:#1d3557;--accent-color:#a8dadc;--light-color:#f1faee;--dark-color:#1b1a1a;--gray-color:#6c757d;--success-color:#2a9d8f;--warning-color:#f4a261;--danger-color:#dc3545;--border-color:#dee2e6;--transition:all .3s ease;--shadow-sm:0 1px 3px rgba(0,0,0,.12);--shadow-md:0 4px 6px rgba(0,0,0,.1);--shadow-lg:0 10px 15px rgba(0,0,0,.1);--border-radius:8px}*{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}body{background-color:#f8f9fa;color:var(--dark-color);font-family:'Roboto',-apple-system,BlinkMacSystemFont,sans-serif;line-height:1.6}.container{margin:0 auto;max-width:1200px;padding:0 15px}.header{background:#fff;-webkit-box-shadow:var(--shadow-sm);box-shadow:var(--shadow-sm);padding:15px 0;position:sticky;top:0;z-index:100}.header-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.logo{height:44px;-webkit-transition:var(--transition);transition:var(--transition)}.logo:hover{-webkit-transform:scale(1.05);transform:scale(1.05)}.nav-menu{display:-webkit-box;display:-ms-flexbox;display:flex;gap:20px}.nav-link{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:var(--border-radius);color:var(--dark-color);font-weight:500;gap:8px;padding:8px 16px;text-decoration:none;-webkit-transition:var(--transition);transition:var(--transition)}.nav-link:hover{background-color:rgba(230,57,70,.1);color:var(--primary-color)}.nav-link.active{background-color:rgba(230,57,70,.1);color:var(--primary-color)}.user-actions{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:15px}.user-dropdown{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:50px;cursor:pointer;gap:10px;padding:8px 16px;position:relative;-webkit-transition:var(--transition);transition:var(--transition)}.user-dropdown:hover{background-color:rgba(0,0,0,.05)}.user-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:var(--primary-color);border-radius:50%;color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:14px;font-weight:600;height:36px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:36px}.user-name{font-weight:500;max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dropdown-menu{background:#fff;border-radius:var(--border-radius);-webkit-box-shadow:var(--shadow-lg);box-shadow:var(--shadow-lg);min-width:200px;opacity:0;-webkit-transform:translateY(-10px);transform:translateY(-10px);padding:10px 0;position:absolute;right:0;top:calc(100% + 10px);-webkit-transition:var(--transition);transition:var(--transition);visibility:hidden;z-index:1000}.user-dropdown:hover .dropdown-menu{opacity:1;-webkit-transform:translateY(0);transform:translateY(0);visibility:visible}.dropdown-item{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:0 0;border:none;color:var(--dark-color);cursor:pointer;font-size:14px;gap:10px;padding:10px 20px;text-decoration:none;-webkit-transition:var(--transition);transition:var(--transition);width:100%}.dropdown-item:hover{background-color:rgba(230,57,70,.1);color:var(--primary-color)}.dropdown-divider{background:var(--border-color);height:1px;margin:5px 0}.btn{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:0 0;border:none;border-radius:50px;cursor:pointer;font-size:14px;font-weight:500;gap:8px;padding:10px 20px;text-decoration:none;-webkit-transition:var(--transition);transition:var(--transition)}.btn-primary{background:var(--primary-color);color:#fff}.btn-primary:hover{background:#d62839;-webkit-transform:translateY(-2px);transform:translateY(-2px)}.btn-outline{background:0 0;border:1px solid var(--border-color);color:var(--dark-color)}.btn-outline:hover{background:rgba(0,0,0,.05);border-color:var(--primary-color)}.btn:disabled{background-color:var(--gray-color);cursor:not-allowed;opacity:.6;-webkit-transform:none;transform:none}.main-content{min-height:calc(100vh - 200px);padding:30px 0}.breadcrumb{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:var(--gray-color);font-size:14px;gap:8px;margin-bottom:30px}.breadcrumb a{color:var(--primary-color);text-decoration:none}.account-layout{display:grid;gap:30px;grid-template-columns:300px 1fr}.account-sidebar{background:#fff;border-radius:var(--border-radius);-webkit-box-shadow:var(--shadow-sm);box-shadow:var(--shadow-sm);height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;padding:30px 20px}.sidebar-header{margin-bottom:30px;text-align:center}.account-avatar{-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:var(--primary-color);border-radius:50%;color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:32px;font-weight:600;height:80px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:0 auto 15px;width:80px}.account-name{color:var(--secondary-color);font-size:20px;font-weight:600;margin-bottom:5px}.account-id{color:var(--gray-color);font-size:14px}.sidebar-menu{margin-bottom:30px}.menu-item{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:0 0;border:none;border-radius:var(--border-radius);color:var(--dark-color);cursor:pointer;font-size:14px;font-weight:500;gap:12px;margin-bottom:8px;padding:12px 16px;text-decoration:none;-webkit-transition:var(--transition);transition:var(--transition);width:100%}.menu-item:hover{background:rgba(230,57,70,.1);color:var(--primary-color)}.menu-item.active{background:var(--primary-color);color:#fff}.menu-item i{text-align:center;width:20px}.account-content{background:#fff;border-radius:var(--border-radius);-webkit-box-shadow:var(--shadow-sm);box-shadow:var(--shadow-sm);padding:30px}.content-header{border-bottom:2px solid var(--border-color);margin-bottom:30px;padding-bottom:15px}.content-title{color:var(--secondary-color);font-size:24px;margin:0}.tab-content{display:none}.tab-content.active{-webkit-animation:fadeIn .3s ease;animation:fadeIn .3s ease;display:block}.info-grid{display:grid;gap:30px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));margin-bottom:30px}.info-item{margin-bottom:20px}.info-label{color:var(--gray-color);display:block;font-size:14px;font-weight:500;margin-bottom:8px}.info-value{border-bottom:1px solid var(--border-color);color:var(--dark-color);font-size:16px;padding:12px 0;word-break:break-all}.balance-card{background:linear-gradient(135deg,var(--primary-color),#d62839);border-radius:var(--border-radius);color:#fff;margin-bottom:30px;padding:30px;text-align:center}.balance-amount{font-size:36px;font-weight:700;margin-bottom:20px}.balance-actions{display:-webkit-box;display:-ms-flexbox;display:flex;gap:15px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.balance-actions .btn{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);color:#fff}.balance-actions .btn:hover{background:rgba(255,255,255,.3)}.balance-actions .btn:disabled{background:rgba(255,255,255,.1);color:rgba(255,255,255,.5);cursor:not-allowed}.history-item{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:1px solid var(--border-color);padding:20px 0}.history-item:last-child{border-bottom:none}.history-icon{-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:50%;display:-webkit-box;display:-ms-flexbox;display:flex;height:48px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-right:15px;width:48px}.history-icon.success{background:rgba(42,157,143,.1);color:var(--success-color)}.history-icon.purchase{background:rgba(230,57,70,.1);color:var(--primary-color)}.history-details{-webkit-box-flex:1;-ms-flex:1;flex:1}.history-title{font-weight:600;margin-bottom:5px}.history-date,.history-info{color:var(--gray-color);font-size:14px}.history-amount{font-size:18px;font-weight:600}.history-amount.success{color:var(--success-color)}.history-amount.purchase{color:var(--primary-color)}.security-item{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;border-bottom:1px solid var(--border-color);padding:20px 0}.security-info{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:15px}.security-info i{color:var(--primary-color);font-size:20px}.security-info h4{font-size:16px;margin-bottom:5px}.security-info p{color:var(--gray-color);font-size:14px}.empty-state{color:var(--gray-color);padding:60px 20px;text-align:center}.empty-state i{font-size:48px;margin-bottom:20px;opacity:.5}.empty-state h3{color:var(--secondary-color);margin-bottom:10px}.login-prompt{background:linear-gradient(135deg,rgba(230,57,70,.1),rgba(29,53,87,.1));border-radius:var(--border-radius);margin:50px 0;padding:60px 30px;text-align:center}.login-prompt i{color:var(--primary-color);font-size:64px;margin-bottom:20px}.login-prompt h2{color:var(--secondary-color);margin-bottom:15px}.login-prompt p{color:var(--gray-color);font-size:16px;margin-bottom:30px}.login-actions{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:15px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.two-fa-content{text-align:center}.two-fa-content .qr-code{background:#fff;border:5px solid var(--border-color);border-radius:var(--border-radius);margin:20px auto;max-width:180px;padding:10px}.backup-codes{background:var(--light-color);border:1px dashed var(--gray-color);border-radius:var(--border-radius);color:var(--secondary-color);font-family:'Courier New',Courier,monospace;font-weight:700;letter-spacing:2px;margin:20px 0;padding:15px}.device-list{margin-top:20px}.device-item{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;border:1px solid var(--border-color);border-radius:var(--border-radius);margin-bottom:10px;padding:15px}.device-item.current{background-color:rgba(42,157,143,.05);border-color:var(--success-color)}.device-details{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:15px}.device-details i{color:var(--secondary-color);font-size:24px}.device-info p{font-weight:700;margin:0}.device-info small{color:var(--gray-color)}.footer{background:var(--dark-color);color:#fff;margin-top:50px;padding:50px 0 20px}.footer-grid{display:grid;gap:30px;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));margin-bottom:30px}.footer-logo{border:2px solid #333;border-radius:var(--border-radius);padding:20px;text-align:center}.footer-logo img{margin-bottom:15px;max-width:150px}.footer-title{font-size:18px;margin-bottom:20px;padding-bottom:10px;position:relative}.footer-title::after{background:var(--primary-color);bottom:0;content:'';height:2px;left:0;position:absolute;width:50px}.footer-links{list-style:none}.footer-link{margin-bottom:10px}.footer-link a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#ccc;gap:8px;text-decoration:none;-webkit-transition:var(--transition);transition:var(--transition)}.footer-link a:hover{color:#fff;-webkit-transform:translateX(5px);transform:translateX(5px)}.footer-bottom{border-top:1px solid #333;color:#999;padding-top:20px;text-align:center}.messenger-chat{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;background:linear-gradient(135deg,#0084ff,#006ce7);border-radius:50%;bottom:20px;color:#fff;cursor:pointer;height:60px;position:fixed;right:20px;-webkit-box-shadow:0 4px 20px rgba(0,132,255,.3);box-shadow:0 4px 20px rgba(0,132,255,.3);text-decoration:none;-webkit-transition:all .3s ease;transition:all .3s ease;width:60px;z-index:1000}.messenger-chat:hover{color:#fff;-webkit-transform:scale(1.1);transform:scale(1.1);-webkit-box-shadow:0 6px 25px rgba(0,132,255,.4);box-shadow:0 6px 25px rgba(0,132,255,.4)}.messenger-chat i{font-size:24px}.messenger-chat::before{-webkit-animation:pulse 2s infinite;animation:pulse 2s infinite;background:inherit;border-radius:50%;content:'';height:100%;position:absolute;width:100%;z-index:-1}@-webkit-keyframes pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}to{-webkit-transform:scale(1.3);transform:scale(1.3);opacity:0}}@keyframes pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}to{-webkit-transform:scale(1.3);transform:scale(1.3);opacity:0}}.messenger-chat .tooltip{background:rgba(0,0,0,.8);border-radius:6px;color:#fff;font-size:14px;opacity:0;padding:8px 12px;position:absolute;right:70px;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50);-webkit-transition:all .3s ease;transition:all .3s ease;visibility:hidden;white-space:nowrap}.messenger-chat .tooltip::after{border:5px solid transparent;border-left-color:rgba(0,0,0,.8);content:'';left:100%;margin-top:-5px;position:absolute;top:50%}.messenger-chat:hover .tooltip{opacity:1;visibility:visible}.modal{display:none;background:rgba(0,0,0,.6);height:100%;left:0;opacity:0;position:fixed;top:0;-webkit-transition:opacity .3s ease;transition:opacity .3s ease;width:100%;z-index:9999}.modal.show{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;opacity:1}.modal-content{background:#fff;border-radius:var(--border-radius);max-height:90vh;max-width:500px;overflow-y:auto;padding:30px;position:relative;-webkit-transform:scale(.9);transform:scale(.9);-webkit-transition:-webkit-transform .3s ease;transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease;width:90%}.modal.show .modal-content{-webkit-transform:scale(1);transform:scale(1)}.modal-close{background:0 0;border:none;color:var(--gray-color);cursor:pointer;font-size:24px;position:absolute;right:15px;top:15px;-webkit-transition:var(--transition);transition:var(--transition)}.modal-close:hover{color:var(--primary-color);-webkit-transform:rotate(90deg);transform:rotate(90deg)}.modal-title{color:var(--secondary-color);font-size:24px;margin-bottom:20px;text-align:center}.form-group{margin-bottom:20px}.form-group label{color:var(--secondary-color);display:block;font-weight:500;margin-bottom:8px}.form-group input,.form-group select{border:1px solid var(--border-color);border-radius:var(--border-radius);font-size:16px;padding:12px 15px;-webkit-transition:var(--transition);transition:var(--transition);width:100%}.form-group input:focus,.form-group select:focus{-webkit-box-shadow:0 0 0 3px rgba(230,57,70,.1);box-shadow:0 0 0 3px rgba(230,57,70,.1);border-color:var(--primary-color);outline:0}.form-group.has-error input,.form-group.has-error select{border-color:var(--danger-color)}.error-message{color:var(--danger-color);display:none;font-size:14px;margin-top:5px}.form-group.has-error .error-message{display:block}.password-group{position:relative}.password-toggle{color:var(--gray-color);cursor:pointer;position:absolute;right:12px;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);-webkit-transition:var(--transition);transition:var(--transition)}.password-toggle:hover{color:var(--primary-color)}.btn-submit{font-size:16px;font-weight:600;padding:15px;position:relative;width:100%}.btn-submit:disabled{cursor:not-allowed;opacity:.6}.spinner{-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;display:none;height:20px;margin-left:10px;width:20px}.btn-submit.loading .spinner{display:inline-block}.card-types{display:grid;gap:10px;grid-template-columns:repeat(4,1fr);margin-bottom:25px}.card-type{background:#fff;border:2px solid var(--border-color);border-radius:var(--border-radius);cursor:pointer;padding:15px 10px;text-align:center;-webkit-transition:var(--transition);transition:var(--transition)}.card-type:hover{border-color:var(--primary-color);-webkit-transform:translateY(-2px);transform:translateY(-2px)}.card-type.selected{background:rgba(230,57,70,.05);border-color:var(--primary-color)}.card-type .card-logo{-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:4px;color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:12px;font-weight:700;height:30px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin:0 auto 8px;max-width:40px;width:100%}.card-type[data-type=viettel] .card-logo{background:#d70018}.card-type[data-type=mobifone] .card-logo{background:#1f7a3e}.card-type[data-type=vinaphone] .card-logo{background:#662d91}.card-type[data-type=gate] .card-logo{background:#ff6600}.card-type span{display:block;font-size:12px;font-weight:500}.form-note{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:rgba(42,157,143,.1);border-radius:var(--border-radius);color:var(--success-color);font-size:14px;gap:8px;margin:15px 0;padding:12px}.form-note i{color:var(--success-color)}.quick-amounts{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:10px;margin-top:15px}.quick-amount{background:#fff;border:1px solid var(--border-color);border-radius:var(--border-radius);cursor:pointer;font-weight:500;padding:10px 15px;-webkit-transition:var(--transition);transition:var(--transition)}.quick-amount:hover{background:rgba(230,57,70,.05);border-color:var(--primary-color);color:var(--primary-color)}.quick-amount.selected{background:rgba(230,57,70,.1);border-color:var(--primary-color);color:var(--primary-color)}.toast{-webkit-box-shadow:var(--shadow-lg);box-shadow:var(--shadow-lg);border-radius:var(--border-radius);color:#fff;font-weight:500;max-width:350px;opacity:0;padding:15px 20px;position:fixed;right:20px;top:20px;-webkit-transform:translateX(120%);transform:translateX(120%);-webkit-transition:all .5s cubic-bezier(.68,-.55,.27,1.55);transition:all .5s cubic-bezier(.68,-.55,.27,1.55);z-index:10000}.toast.show{opacity:1;-webkit-transform:translateX(0);transform:translateX(0)}.toast.success{background:var(--success-color)}.toast.error{background:var(--danger-color)}.toast.info{background:var(--secondary-color)}.toast.warning{background:var(--warning-color)}@media (max-width:992px){.account-layout{gap:20px;grid-template-columns:1fr}.account-sidebar{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:20px;text-align:left}.sidebar-header{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0 20px 0 0;text-align:left}.account-avatar{margin:0 15px 0 0}.sidebar-menu{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1;flex:1;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:10px;margin:0}.menu-item{border-radius:20px;margin:0;padding:8px 12px;white-space:nowrap}.messenger-chat{bottom:15px;height:50px;right:15px;width:50px}.messenger-chat i{font-size:20px}}@media (max-width:768px){.header-container{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:15px}.nav-menu{-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.info-grid{grid-template-columns:1fr}.balance-actions,.login-actions{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.messenger-chat .tooltip{display:none}}@media (max-width:576px){.sidebar-header{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;text-align:center}.account-avatar{margin:0 0 15px}.sidebar-menu{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}}@-webkit-keyframes fadeIn{0%{opacity:0;-webkit-transform:translateY(20px);transform:translateY(20px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes fadeIn{0%{opacity:0;-webkit-transform:translateY(20px);transform:translateY(20px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container header-container">
            <a href="index.html">
                <img src="https://i.ibb.co/q3r1hTft/8574d186247eba75669b7d50d42bd650-png.png" alt="Shop Grow A Garden" class="logo">
            </a>
            
            <nav class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>Trang Chủ</span>
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-seedling"></i>
                    <span>Giống Cây</span>
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-paw"></i>
                    <span>Thú Cưng</span>
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-gamepad"></i>
                    <span>Tài Khoản Game</span>
                </a>
            </nav>

            <div class="user-actions">
                <!-- This will be dynamically populated by JS -->
                <a href="index.html" class="btn btn-primary" id="loginButton">
                    <i class="fas fa-user"></i>
                    <span>Đăng Nhập</span>
                </a>
                <div class="user-dropdown" id="userDropdown" style="display: none;">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span class="user-name" id="userName">User</span>
                    <div class="dropdown-menu">
                        <a href="account.html" class="dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>Tài khoản</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-heart"></i>
                            <span>Yêu thích</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Giỏ hàng</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Đăng xuất</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container main-content">
        <div class="breadcrumb">
            <a href="index.html">Trang chủ</a>
            <i class="fas fa-chevron-right"></i>
            <span>Tài khoản</span>
        </div>
        
        <!-- Content for logged in users -->
        <div id="accountContent" style="display: none;">
            <div class="account-layout">
                <!-- Sidebar -->
                <div class="account-sidebar">
                    <div class="sidebar-header">
                        <div class="account-avatar" id="accountAvatar">U</div>
                        <div>
                            <h2 class="account-name" id="accountName">User</h2>
                            <div class="account-id" id="accountId">ID: 000001</div>
                        </div>
                    </div>
                    
                    <nav class="sidebar-menu">
                        <button class="menu-item active" data-tab="info">
                            <i class="fas fa-user"></i>
                            Thông tin tài khoản
                        </button>
                        <button class="menu-item" data-tab="balance">
                            <i class="fas fa-wallet"></i>
                            Số dư & Nạp tiền
                        </button>
                        <button class="menu-item" data-tab="history">
                            <i class="fas fa-history"></i>
                            Lịch sử giao dịch
                        </button>
                        <button class="menu-item" data-tab="security">
                            <i class="fas fa-shield-alt"></i>
                            Bảo mật
                        </button>
                    </nav>
                    
                    <button class="btn btn-outline" id="sidebarLogoutBtn" style="width: 100%;">
                        <i class="fas fa-sign-out-alt"></i>
                        Đăng xuất
                    </button>
                </div>
                
                <!-- Content -->
                <div class="account-content">
                    <!-- Account Info Tab -->
                    <div class="tab-content active" id="infoTab">
                        <div class="content-header">
                            <h2 class="content-title">Thông tin tài khoản</h2>
                        </div>
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <label class="info-label">Họ và tên</label>
                                <div class="info-value" id="userFullName"></div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Email</label>
                                <div class="info-value" id="userEmail"></div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Số điện thoại</label>
                                <div class="info-value" id="userPhone"></div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Ngày đăng ký</label>
                                <div class="info-value" id="userRegisterDate"></div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">ID tài khoản</label>
                                <div class="info-value" id="userAccountId"></div>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Trạng thái</label>
                                <div class="info-value" style="color: var(--success-color);">Đã xác thực</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Other tabs (Balance, History, Security) remain the same -->
                     <!-- Balance Tab -->
                    <div class="tab-content" id="balanceTab">
                        <div class="content-header">
                            <h2 class="content-title">Số dư tài khoản</h2>
                        </div>
                        
                        <div class="balance-card">
                            <div class="balance-amount" id="balanceAmount">0đ</div>
                            <div class="balance-actions">
                                <button class="btn" id="depositBtn">
                                    <i class="fas fa-money-bill-wave"></i>
                                    Nạp tiền
                                </button>
                                <button class="btn" id="withdrawBtn">
                                    <i class="fas fa-hand-holding-usd"></i>
                                    Rút tiền
                                </button>
                            </div>
                        </div>
                        
                        <div class="quick-deposit">
                            <h3>Nạp nhanh theo mệnh giá</h3>
                            <div class="quick-amounts">
                                <button class="quick-amount" data-amount="10000">10,000đ</button>
                                <button class="quick-amount" data-amount="20000">20,000đ</button>
                                <button class="quick-amount" data-amount="50000">50,000đ</button>
                                <button class="quick-amount" data-amount="100000">100,000đ</button>
                                <button class="quick-amount" data-amount="200000">200,000đ</button>
                                <button class="quick-amount" data-amount="500000">500,000đ</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- History Tab -->
                    <div class="tab-content" id="historyTab">
                        <div class="content-header">
                            <h2 class="content-title">Lịch sử giao dịch</h2>
                        </div>
                        
                        <div class="history-list" id="historyList">
                            <!-- History items will be injected here by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Security Tab -->
                    <div class="tab-content" id="securityTab">
                        <div class="content-header">
                            <h2 class="content-title">Bảo mật tài khoản</h2>
                        </div>
                        
                        <div class="security-settings">
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-lock"></i>
                                    <div>
                                        <h4>Mật khẩu</h4>
                                        <p>Đã thiết lập</p>
                                        <small>Bảo mật tài khoản của bạn</small>
                                    </div>
                                </div>
                                <button class="btn btn-outline" id="changePasswordBtn">
                                    <i class="fas fa-edit"></i>
                                    Đổi mật khẩu
                                </button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-shield-alt"></i>
                                    <div>
                                        <h4>Xác thực 2 bước (2FA)</h4>
                                        <p id="2faStatus">Chưa bật</p>
                                        <small>Tăng cường bảo mật cho tài khoản</small>
                                    </div>
                                </div>
                                <button class="btn btn-outline" id="toggle2faBtn">
                                    <i class="fas fa-toggle-off"></i>
                                    <span>Bật</span>
                                </button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-laptop-house"></i>
                                    <div>
                                        <h4>Thiết bị đã đăng nhập</h4>
                                        <p>Quản lý các phiên đăng nhập</p>
                                        <small>Xem và đăng xuất khỏi các thiết bị khác</small>
                                    </div>
                                </div>
                                <button class="btn btn-outline" id="manageDevicesBtn">
                                    <i class="fas fa-cog"></i>
                                    Quản lý
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Login prompt for non-logged users -->
        <div id="loginPrompt" style="display: none;">
            <div class="login-prompt">
                <i class="fas fa-user-lock"></i>
                <h2>Yêu cầu đăng nhập</h2>
                <p>Bạn cần đăng nhập để xem thông tin tài khoản và sử dụng các tính năng.</p>
                <div class="login-actions">
                    <a href="index.html" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i>
                        Về trang đăng nhập
                    </a>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Modals and Footer remain the same -->
    <!-- ... (All modals and footer HTML from previous version) ... -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-logo">
                    <img src="https://i.ibb.co/k6BvctRR/t-i-xu-ng.jpg" alt="Shop Grow A Garden">
                    <span>Shop Grow A Garden - Giống Cây - Thú Cưng</span>
                </div>
                
                <div>
                    <h3 class="footer-title">Về Chúng Tôi</h3>
                    <p>Chuyên cung cấp dịch vụ, giống cây và thú cưng chất lượng. Giao dịch nhanh chóng, uy tín.</p>
                </div>
                
                <div>
                    <h3 class="footer-title">Liên Hệ</h3>
                    <ul class="footer-links">
                        <li class="footer-link">
                            <a href="mailto:support@shopgrowgarden.com">
                                <i class="fas fa-envelope"></i>
                                <span>Email: support@shopgrowgarden.com</span>
                            </a>
                        </li>
                        <li class="footer-link">
                            <a href="tel:0123456789">
                                <i class="fas fa-phone"></i>
                                <span>Hotline: 0123 456 789</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>© 2025 Shop Grow A Garden. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- ===== MODALS ===== -->

    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <button class="modal-close" onclick="ModalManager.closeModal('depositModal')">×</button>
            <h2 class="modal-title">Nạp tiền bằng thẻ cào</h2>
            
            <div class="card-types">
                <div class="card-type selected" data-type="viettel">
                    <div class="card-logo">VT</div>
                    <span>Viettel</span>
                </div>
                <div class="card-type" data-type="mobifone">
                    <div class="card-logo">MB</div>
                    <span>Mobifone</span>
                </div>
                <div class="card-type" data-type="vinaphone">
                    <div class="card-logo">VP</div>
                    <span>Vinaphone</span>
                </div>
                <div class="card-type" data-type="gate">
                    <div class="card-logo">GT</div>
                    <span>Gate</span>
                </div>
            </div>
            
            <form id="depositForm">
                <div class="form-group">
                    <label for="cardNumber">Mã thẻ</label>
                    <input type="text" id="cardNumber" placeholder="Nhập mã thẻ" required pattern="\d{10,15}">
                    <div class="error-message"></div>
                </div>
                
                <div class="form-group">
                    <label for="cardSerial">Số serial</label>
                    <input type="text" id="cardSerial" placeholder="Nhập số serial" required pattern="\d{5,12}">
                    <div class="error-message"></div>
                </div>
                
                <div class="form-group">
                    <label for="cardAmount">Mệnh giá</label>
                    <select id="cardAmount" required>
                        <option value="">-- Chọn mệnh giá --</option>
                        <option value="10000">10,000đ</option>
                        <option value="20000">20,000đ</option>
                        <option value="50000">50,000đ</option>
                        <option value="100000">100,000đ</option>
                        <option value="200000">200,000đ</option>
                        <option value="500000">500,000đ</option>
                    </select>
                    <div class="error-message"></div>
                </div>
                
                <div class="form-note">
                    <i class="fas fa-info-circle"></i>
                    <span>Vui lòng chọn đúng mệnh giá, sai mệnh giá sẽ mất thẻ.</span>
                </div>
                
                <button type="submit" class="btn btn-primary btn-submit">
                    <i class="fas fa-check-circle"></i>
                    <span>Nạp tiền</span>
                    <div class="spinner"></div>
                </button>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <button class="modal-close" onclick="ModalManager.closeModal('changePasswordModal')">×</button>
            <h2 class="modal-title">Đổi mật khẩu</h2>
            
            <form id="changePasswordForm">
                <div class="form-group password-group">
                    <label for="currentPassword">Mật khẩu hiện tại</label>
                    <input type="password" id="currentPassword" placeholder="Nhập mật khẩu hiện tại" required>
                    <span class="password-toggle" onclick="Utils.togglePassword('currentPassword')">
                        <i class="fas fa-eye"></i>
                    </span>
                    <div class="error-message"></div>
                </div>
                
                <div class="form-group password-group">
                    <label for="newPassword">Mật khẩu mới</label>
                    <input type="password" id="newPassword" placeholder="Nhập mật khẩu mới (ít nhất 6 ký tự)" required minlength="6">
                    <span class="password-toggle" onclick="Utils.togglePassword('newPassword')">
                        <i class="fas fa-eye"></i>
                    </span>
                    <div class="error-message"></div>
                </div>
                
                <div class="form-group password-group">
                    <label for="confirmNewPassword">Nhập lại mật khẩu mới</label>
                    <input type="password" id="confirmNewPassword" placeholder="Nhập lại mật khẩu mới" required>
                    <span class="password-toggle" onclick="Utils.togglePassword('confirmNewPassword')">
                        <i class="fas fa-eye"></i>
                    </span>
                    <div class="error-message"></div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-submit">
                    <i class="fas fa-key"></i>
                    <span>Đổi mật khẩu</span>
                    <div class="spinner"></div>
                </button>
            </form>
        </div>
    </div>
    
    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <button class="modal-close" onclick="ModalManager.closeModal('withdrawModal')">×</button>
            <h2 class="modal-title">Rút tiền</h2>
            <form id="withdrawForm">
                <div class="form-group">
                    <label for="bankAccount">Ngân hàng</label>
                    <select id="bankAccount" required>
                        <option value="">-- Chọn ngân hàng --</option>
                        <option value="mbbank">MB Bank</option>
                        <option value="vietcombank">Vietcombank</option>
                        <option value="techcombank">Techcombank</option>
                        <option value="momo">Ví Momo</option>
                    </select>
                    <div class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="accountNumber">Số tài khoản / Số điện thoại</label>
                    <input type="text" id="accountNumber" placeholder="Nhập số tài khoản" required>
                    <div class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="withdrawAmount">Số tiền rút</label>
                    <input type="number" id="withdrawAmount" placeholder="Nhập số tiền" required min="50000">
                     <small style="color: var(--gray-color);">Số tiền rút tối thiểu là 50,000đ</small>
                    <div class="error-message"></div>
                </div>
                <div class="form-note" style="background-color: rgba(244, 162, 97, 0.1); color: var(--warning-color);">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Phí rút tiền là 2%. Yêu cầu sẽ được xử lý trong 5-10 phút.</span>
                </div>
                 <button type="submit" class="btn btn-primary btn-submit">
                    <i class="fas fa-paper-plane"></i>
                    <span>Gửi yêu cầu</span>
                    <div class="spinner"></div>
                </button>
            </form>
        </div>
    </div>

    <!-- 2FA Modal -->
    <div class="modal" id="2faModal">
        <div class="modal-content">
            <button class="modal-close" onclick="ModalManager.closeModal('2faModal')">×</button>
            <h2 class="modal-title">Thiết lập Xác thực 2 bước</h2>
            <div class="two-fa-content">
                <p>Quét mã QR này bằng ứng dụng xác thực của bạn (ví dụ: Google Authenticator).</p>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=otpauth://totp/ShopGrowAGarden?secret=JBSWY3DPEHPK3PXP" alt="QR Code" class="qr-code">
                <p>Nếu không thể quét mã, hãy nhập mã này thủ công:</p>
                <p style="font-weight: bold; font-family: monospace;">JBSWY3DPEHPK3PXP</p>
                <div class="form-note" style="background-color: rgba(220, 53, 69, 0.1); color: var(--danger-color);">
                    <i class="fas fa-shield-alt"></i>
                    <span>Lưu lại các mã khôi phục này ở nơi an toàn.</span>
                </div>
                <div class="backup-codes">
                    <p>1a2b-3c4d-5e6f-7g8h</p>
                    <p>9i0j-1k2l-3m4n-5o6p</p>
                </div>
                <button type="button" class="btn btn-primary btn-submit" onclick="AccountManager.enable2FA()">
                    <i class="fas fa-check-circle"></i>
                    <span>Tôi đã lưu lại, Hoàn tất</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Device Manager Modal -->
    <div class="modal" id="deviceManagerModal">
        <div class="modal-content">
            <button class="modal-close" onclick="ModalManager.closeModal('deviceManagerModal')">×</button>
            <h2 class="modal-title">Quản lý Thiết bị</h2>
            <div class="device-list">
                <div class="device-item current">
                    <div class="device-details">
                        <i class="fas fa-desktop"></i>
                        <div class="device-info">
                            <p>Chrome trên Windows</p>
                            <small>This PC - Đang hoạt động</small>
                        </div>
                    </div>
                </div>
                 <div class="device-item">
                    <div class="device-details">
                        <i class="fas fa-mobile-alt"></i>
                        <div class="device-info">
                            <p>Safari trên iPhone 14 Pro</p>
                            <small>Hoạt động 2 giờ trước</small>
                        </div>
                    </div>
                    <button class="btn btn-outline" style="border-color: var(--danger-color); color: var(--danger-color);" onclick="this.parentElement.remove()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        // ===== CORE UTILITIES (Keep as is) =====
        const Utils = {formatPrice:(e)=>{const t="string"==typeof e?parseInt(e):e;return new Intl.NumberFormat("vi-VN").format(t)+"đ"},formatDate:e=>new Date(e).toLocaleDateString("vi-VN"),formatDateTime:e=>new Date(e).toLocaleString("vi-VN"),showToast:(e,t="success",o=3e3)=>{document.querySelectorAll(".toast").forEach(e=>e.remove());const a=document.createElement("div");a.className=`toast ${t}`,a.innerHTML=`<span>${e}</span>\n                    <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; margin-left: 10px; cursor: pointer; font-size: 16px;">×</button>`,document.body.appendChild(a),setTimeout(()=>{a.classList.add("show")},100),setTimeout(()=>{a.classList.remove("show"),setTimeout(()=>{a.remove()},500)},o)},validateInput:(e,t,o)=>{return e.value.trim()?o&&!o.test(e.value)?(Utils.showError(e,t),!1):(Utils.clearError(e),!0):(Utils.showError(e,`Vui lòng nhập ${e.labels[0].textContent.toLowerCase()}.`),!1)},showError:(e,t)=>{const o=e.closest(".form-group");o.classList.add("has-error");const a=o.querySelector(".error-message");a&&(a.textContent=t)},clearError:e=>{e.closest(".form-group").classList.remove("has-error")},togglePassword:e=>{const t=document.getElementById(e),o=document.querySelector(`[onclick*="${e}"] i`);"password"===t.type?(t.type="text",o.classList.remove("fa-eye"),o.classList.add("fa-eye-slash")):(t.type="password",o.classList.remove("fa-eye-slash"),o.classList.add("fa-eye"))}};

        // ===== MODAL MANAGER (Keep as is) =====
        const ModalManager = {showModal:e=>{const t=document.getElementById(e);t&&(t.style.display="flex",setTimeout(()=>{t.classList.add("show")},10),document.body.style.overflow="hidden")},closeModal:e=>{const t=document.getElementById(e);if(t){t.classList.remove("show"),setTimeout(()=>{t.style.display="none",document.body.style.overflow="auto";const e=t.querySelector("form");if(e){e.reset(),e.querySelectorAll(".form-group.has-error").forEach(e=>{e.classList.remove("has-error")});const t=e.querySelector(".btn-submit");t&&(t.classList.remove("loading"),t.disabled=!1)}},300)}}};

        // ===== ACCOUNT MANAGER =====
        const AccountManager = {
            currentUser: null,

            init() {
                // MODIFIED: Read user from localStorage as the source of truth
                const storedUser = localStorage.getItem('currentUser');

                if (storedUser) {
                    this.currentUser = JSON.parse(storedUser);
                    this.showPageContent();
                } else {
                    this.showLoginPrompt();
                }
            },
            
            showPageContent() {
                document.getElementById('accountContent').style.display = 'block';
                document.getElementById('loginPrompt').style.display = 'none';
                
                // Populate header and page with user data
                this.updateHeaderUI();
                this.updatePageUI();
                this.setupEventListeners();
            },

            showLoginPrompt() {
                document.getElementById('accountContent').style.display = 'none';
                document.getElementById('loginPrompt').style.display = 'block';
            },
            
            updateHeaderUI() {
                const userDropdown = document.getElementById('userDropdown');
                const loginButton = document.getElementById('loginButton');

                if (this.currentUser) {
                    userDropdown.style.display = 'flex';
                    loginButton.style.display = 'none';
                    document.getElementById('userAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                    document.getElementById('userName').textContent = this.currentUser.name;
                    document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                } else {
                     userDropdown.style.display = 'none';
                    loginButton.style.display = 'flex';
                }
            },

            updatePageUI() {
                // Sidebar
                document.getElementById('accountAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                document.getElementById('accountName').textContent = this.currentUser.name;
                document.getElementById('accountId').textContent = `ID: ${this.currentUser._id.slice(-6)}`;
                
                // Main Info
                document.getElementById('userFullName').textContent = this.currentUser.name;
                document.getElementById('userEmail').textContent = this.currentUser.email;
                document.getElementById('userPhone').textContent = this.currentUser.phone || 'Chưa cập nhật';
                document.getElementById('userRegisterDate').textContent = Utils.formatDate(this.currentUser.createdAt);
                document.getElementById('userAccountId').textContent = this.currentUser._id;

                // Load user-specific data from localStorage
                this.loadPersonalizedState();
            },

            loadPersonalizedState() {
                const userId = this.currentUser._id;
                const balance = localStorage.getItem(`balance_${userId}`) || '0';
                const is2FAEnabled = localStorage.getItem(`2fa_${userId}`) === 'true';

                document.getElementById('balanceAmount').textContent = Utils.formatPrice(balance);
                this.update2FAStatusUI(is2FAEnabled);
                this.loadTransactionHistory();
            },
            
            loadTransactionHistory() {
                const historyList = document.getElementById('historyList');
                const transactions = JSON.parse(localStorage.getItem(`transactions_${this.currentUser._id}`)) || [];
                
                if (transactions.length === 0) {
                    historyList.innerHTML = `<div class="empty-state"><i class="fas fa-history"></i><h3>Chưa có giao dịch nào</h3><p>Lịch sử giao dịch sẽ hiển thị tại đây.</p></div>`;
                    return;
                }
                historyList.innerHTML = transactions.slice().reverse().map(this.createHistoryItemHTML).join('');
            },

            createHistoryItemHTML(transaction) {
                const isDeposit = transaction.type === 'deposit';
                const iconClass = isDeposit ? 'success' : 'purchase';
                const icon = isDeposit ? 'fa-plus' : 'fa-hand-holding-usd';
                const amountClass = isDeposit ? 'success' : 'purchase';
                const amountPrefix = isDeposit ? '+' : '-';
                const title = isDeposit ? 'Nạp tiền thành công' : 'Yêu cầu rút tiền';
                const info = isDeposit ? `Thẻ ${transaction.info}` : `Về ${transaction.info}`;

                return `<div class="history-item">
                            <div class="history-icon ${iconClass}"><i class="fas ${icon}"></i></div>
                            <div class="history-details">
                                <div class="history-title">${title}</div>
                                <div class="history-date">${Utils.formatDateTime(transaction.date)}</div>
                                <div class="history-info">${info}</div>
                            </div>
                            <div class="history-amount ${amountClass}">${amountPrefix}${Utils.formatPrice(transaction.amount)}</div>
                        </div>`;
            },
            
            processDeposit() {
                // ... (validation logic from previous version)
                const form = document.getElementById('depositForm');
                const submitBtn = form.querySelector('.btn-submit');
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;

                setTimeout(() => {
                    const amount = parseInt(document.getElementById('cardAmount').value);
                    const userId = this.currentUser._id;
                    let currentBalance = parseInt(localStorage.getItem(`balance_${userId}`) || '0');
                    currentBalance += amount;
                    localStorage.setItem(`balance_${userId}`, currentBalance);
                    
                    const transactions = JSON.parse(localStorage.getItem(`transactions_${userId}`)) || [];
                    transactions.push({
                        type: 'deposit',
                        amount: amount,
                        info: document.querySelector('.card-type.selected').dataset.type.toUpperCase(),
                        date: new Date().toISOString()
                    });
                    localStorage.setItem(`transactions_${userId}`, JSON.stringify(transactions));

                    this.loadPersonalizedState(); // Reload UI
                    Utils.showToast(`Nạp tiền thành công ${Utils.formatPrice(amount)}`, 'success');
                    ModalManager.closeModal('depositModal');
                }, 1500);
            },
            
            processWithdrawal() {
                // ... (validation logic)
                const submitBtn = document.querySelector('#withdrawForm .btn-submit');
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;

                setTimeout(() => {
                    const amount = parseInt(document.getElementById('withdrawAmount').value);
                    const userId = this.currentUser._id;
                    let currentBalance = parseInt(localStorage.getItem(`balance_${userId}`) || '0');
                    
                    if(amount > currentBalance) {
                        Utils.showToast('Số dư không đủ.', 'error');
                        submitBtn.classList.remove('loading');
                        submitBtn.disabled = false;
                        return;
                    }

                    currentBalance -= amount;
                    localStorage.setItem(`balance_${userId}`, currentBalance);

                    const transactions = JSON.parse(localStorage.getItem(`transactions_${userId}`)) || [];
                    transactions.push({
                        type: 'withdraw',
                        amount: amount,
                        info: document.getElementById('bankAccount').value.toUpperCase(),
                        date: new Date().toISOString()
                    });
                    localStorage.setItem(`transactions_${userId}`, JSON.stringify(transactions));
                    
                    this.loadPersonalizedState();
                    Utils.showToast('Yêu cầu rút tiền đã được gửi!', 'success');
                    ModalManager.closeModal('withdrawModal');
                }, 1500);
            },
            
            update2FAStatusUI(isEnabled) {
                 const statusEl = document.getElementById('2faStatus');
                 const buttonEl = document.getElementById('toggle2faBtn');
                 statusEl.textContent = isEnabled ? 'Đã bật' : 'Chưa bật';
                 statusEl.style.color = isEnabled ? 'var(--success-color)' : 'var(--gray-color)';
                 buttonEl.innerHTML = isEnabled ? '<i class="fas fa-toggle-on"></i> <span>Tắt</span>' : '<i class="fas fa-toggle-off"></i> <span>Bật</span>';
            },
            
            toggle2FA() {
                const key = `2fa_${this.currentUser._id}`;
                const isEnabled = localStorage.getItem(key) === 'true';
                if (isEnabled) {
                    if (confirm('Bạn có chắc chắn muốn tắt Xác thực 2 bước không?')) {
                        localStorage.setItem(key, 'false');
                        this.update2FAStatusUI(false);
                        Utils.showToast('Xác thực 2 bước đã được tắt.', 'info');
                    }
                } else {
                    ModalManager.showModal('2faModal');
                }
            },

            enable2FA() {
                const key = `2fa_${this.currentUser._id}`;
                localStorage.setItem(key, 'true');
                this.update2FAStatusUI(true);
                Utils.showToast('Xác thực 2 bước đã được bật thành công!', 'success');
                ModalManager.closeModal('2faModal');
            },

            setupEventListeners() {
                document.querySelectorAll('.menu-item').forEach(item => item.addEventListener('click', e => this.switchTab(e.currentTarget.dataset.tab)));
                document.getElementById('depositBtn').addEventListener('click', () => ModalManager.showModal('depositModal'));
                document.getElementById('withdrawBtn').addEventListener('click', () => ModalManager.showModal('withdrawModal'));
                document.getElementById('changePasswordBtn').addEventListener('click', () => ModalManager.showModal('changePasswordModal'));
                document.getElementById('toggle2faBtn').addEventListener('click', () => this.toggle2FA());
                document.getElementById('manageDevicesBtn').addEventListener('click', () => ModalManager.showModal('deviceManagerModal'));
                document.getElementById('sidebarLogoutBtn').addEventListener('click', () => this.logout());
                
                document.getElementById('depositForm').addEventListener('submit', e => { e.preventDefault(); this.processDeposit(); });
                document.getElementById('withdrawForm').addEventListener('submit', e => { e.preventDefault(); this.processWithdrawal(); });
                document.getElementById('changePasswordForm').addEventListener('submit', e => { e.preventDefault(); Utils.showToast('Mô phỏng: Mật khẩu đã được thay đổi!', 'success'); ModalManager.closeModal('changePasswordModal'); });
                
                document.querySelectorAll('.quick-amount').forEach(btn => btn.addEventListener('click', e => {
                    document.getElementById('cardAmount').value = e.target.dataset.amount;
                    ModalManager.showModal('depositModal');
                }));

                document.querySelectorAll('.card-type').forEach(card => card.addEventListener('click', e => {
                    document.querySelectorAll('.card-type').forEach(c => c.classList.remove('selected'));
                    e.currentTarget.classList.add('selected');
                }));
            },

            switchTab(tabId) {
                document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.getElementById(`${tabId}Tab`).classList.add('active');
            },
            
            logout() {
                if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('token');
                    Utils.showToast('Đăng xuất thành công!', 'success');
                    setTimeout(() => { window.location.href = 'index.html'; }, 1000);
                }
            }
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            AccountManager.init();
        });
    </script>
</body>
</html>
